{% extends "base.html" %}
{% set page_class = "brigands" %}
{% block content %}

<div class="container" style="background-color: transparent;">
  <h1>Gestion des brigands</h1>

  <!-- Message de retour -->
  <div id="message" class="message-area"></div>

  <main class="container">
    <!-- Bloc principal : Création / Modification / Suppression -->
    <div style="background-color: #f5f0e6; padding: 2rem; border-radius: 8px;">
      <section class="brigand-form">
        <h2>Création d’un brigand</h2>
        <form id="formulaireCreation" class="grid">
          <div class="field">
            <label for="nomIG">Nom IG</label>
            <input type="text" id="nomIG" name="nom" required placeholder="Ex: Bidule" />
          </div>

          <div class="field">
            <label for="listePrincipale">Listes principales</label>
            <select id="listePrincipale" name="liste">
              <option value="" selected>Aucune</option>
              <option value="surveillance">Liste de surveillance</option>
              <option value="noire">Liste noire</option>
              <option value="hors">Liste noire hors A&C</option>
              <option value="archives">Archives</option>
            </select>
          </div>

          <div class="field">
            <label for="organisationSelect">Organisation brigande</label>
            <select id="organisationSelect" name="organisation_id">
              <option value="">Aucune</option>
            </select>
          </div>

          <div class="field span-2">
            <label for="faitsReproches">Faits reprochés</label>
            <textarea id="faitsReproches" name="faits" rows="3" placeholder="Ex: Prise mairie Lectoure le 08/1471"></textarea>
          </div>

          <div class="field check">
            <label><input type="checkbox" id="rechercheCouronne" name="recherche_couronne" /> Recherché par la couronne</label>
          </div>
          <div class="field check">
            <label><input type="checkbox" id="estPNG" name="est_png" /> PNG</label>
          </div>

          <div class="actions">
            <button type="submit" class="btn brigand">Ajouter</button>
          </div>
        </form>

        <br>
        <h3>Modifier un brigand</h3>
        <form id="formulaireRecherche" class="grid">
          <div class="field" style="max-width: 300px;">
            <label for="rechercheNom">Nom IG</label>
            <input type="text" id="rechercheNom" placeholder="Ex: Bidule" />
          </div>
          <div class="actions" style="max-width: 300px;">
            <button type="button" class="btn brigand">Modifier</button>
          </div>
        </form>

        <br>
        <h3>Supprimer un ou plusieurs brigands</h3>
        <form id="formulaireSuppression" class="grid">
          <div class="field" style="max-width: 400px;">
            <label for="nomsSuppression">Supprimer un ou plusieurs brigands (séparés par un ;)</label>
            <textarea id="nomsSuppression" rows="4" placeholder="Ex: Bidule;Machin;Trucmuche"></textarea>
          </div>
          <div class="actions" style="max-width: 300px;">
            <button type="submit" class="btn brigand">Supprimer</button>
          </div>
        </form>
      </section>
    </div>

    <br>

    <!-- Bloc organisations brigandes -->
    <div style="background-color: #f5f0e6; padding: 2rem; border-radius: 8px;">
      <section class="brigand-form">
        <h2>Gérer les organisations brigandes</h2>
        <div class="organisations-layout">
          <div class="organisations-gestion">
            <h4>Ajouter une organisation</h4>
            <form id="formulaireOrganisation" class="grid">
              <div class="field">
                <label for="nomCompletOrganisation">Nom complet</label>
                <input type="text" id="nomCompletOrganisation" name="nom_complet" required />
              </div>
              <div class="field">
                <label for="nomAbregeOrganisation">Nom abrégé</label>
                <input type="text" id="nomAbregeOrganisation" name="nom_abrege" />
              </div>
              <div class="actions">
                <button class="btn brigand" type="submit">Ajouter</button>
              </div>
            </form>
            <div id="table-organisations-ajoutees"></div>
          </div>
        </div>
      </section>
    </div>

    <!-- Ligne séparatrice avant les membres -->
    <hr style="border: none; border-top: 2px solid #5a3e2b; margin: 2rem 0; width: 60%;">

    <h4>Membres par organisation</h4>
    <div id="organisations-membres"></div>

    <!-- Onglets -->
    <div class="tabs">
      <button class="tab active" data-tab="principales">Listes principales</button>
      <button class="tab" data-tab="couronne-png">Couronne & PNG</button>
      <button class="tab" data-tab="organisations">Organisations brigandes</button>
    </div>

    <!-- Listes principales -->
    <section id="tab-principales" class="pane active">
      <section class="card"><h3>Liste noire</h3><div id="table-noire"></div></section>
      <section class="card"><h3>Liste de surveillance</h3><div id="table-surveillance"></div></section>
      <section class="card"><h3>Liste noire hors A&amp;C</h3><div id="table-hors"></div></section>
      <section class="card"><h3>Archives</h3><div id="table-archives"></div></section>
    </section>

    <!-- Couronne & PNG -->
    <section id="tab-couronne-png" class="pane">
      <section class="card"><h3>Recherchés par la couronne</h3><div id="table-couronne"></div></section>
      <section class="card"><h3>PNG</h3><div id="table-png"></div></section>
    </section>

    <!-- Organisations brigandes -->
    <section id="tab-organisations" class="pane">
      <section class="card"><h3>Organisations brigandes</h3><div id="table-organisations"></div></section>
    </section>
  </main>

  <!-- Modale d’édition harmonisée -->
  <div id="modaleEdition" class="modal hidden" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Modifier un brigand</h3>
        <button class="close" id="fermerModale" aria-label="Fermer">×</button>
      </div>
      <form id="formulaireEdition" class="grid">
        <input type="hidden" id="identifiantBrigand" name="id" />
        <div class="field">
          <label for="nomBrigandEdition">Nom IG</label>
          <input type="text" id="nomBrigandEdition" name="nom" required />
        </div>

        <div class="field">
          <label for="listePrincipaleEdition">Listes principales</label>
          <select id="listePrincipaleEdition" name="liste">
            <option value="">Aucune</option>
            <option value="surveillance">Liste de surveillance</option>
            <option value="noire">Liste noire</option>
            <option value="hors">Liste noire hors A&C</option>
            <option value="archives">Archives</option>
          </select>
        </div>

        <div class="field">
          <label for="organisationEdition">Organisation brigande</label>
          <select id="organisationEdition" name="organisation_id">
            <option value="">Aucune</option>
          </select>
        </div>

        <div class="field span-2">
          <label for="faitsEdition">Faits reprochés</label>
          <textarea id="faitsEdition" name="faits" rows="3"></textarea>
        </div>

        <div class="field check">
          <label><input type="checkbox" id="rechercheCouronneEdition" name="recherche_couronne" /> Recherché par la couronne</label>
        </div>

        <div class="field check">
          <label><input type="checkbox" id="estPNGEdition" name="est_png" /> PNG</label>
        </div>

        <div class="actions">
          <button type="submit" class="btn primary">Valider</button>
          <button type="button" class="btn brigand" id="supprimerEntree">Supprimer</button>
          <button type="button" class="btn" id="annulerEdition">Annuler</button>
        </div>
      </form>
    </div>
  </div> 
{% endblock %}
