{% extends 'base.html' %}

{% block content %}
<h1>Déposer un rapport</h1>

{% if blocked %}
  <div style="background:#ffd3d3;border:1px solid #cc6a6a;padding:.6rem;margin:.6rem 0;">
    Dépôt de rapports momentanément bloqué (créneau horaire).
  </div>
{% endif %}

{% with msgs = get_flashed_messages() %}
  {% if msgs %}
    <ul style="color:red">
      {% for m in msgs %}
        <li>{{ m }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<form method="post" style="display:flex;flex-direction:column;gap:.9rem;max-width:900px">
  {% set disabled = 'disabled' if blocked else '' %}

  <!-- Ligne 1 : question + radios SUR LA MÊME LIGNE -->
  <div style="display:flex;flex-wrap:wrap;align-items:center;gap:.8rem">
    <div style="min-width:260px"><strong>Vous avez effectué votre garde :</strong></div>
    <label style="display:inline-flex;align-items:center;gap:.35rem">
      <input type="radio" name="tour_de_garde" value="oui"
             {% if form and form.get('tour_de_garde') == 'oui' %}checked{% endif %} {{ disabled }}>
      Oui
    </label>
    <label style="display:inline-flex;align-items:center;gap:.35rem;">
      <input type="radio" name="tour_de_garde" value="non"
             {% if form and form.get('tour_de_garde') == 'non' %}checked{% endif %} {{ disabled }}>
      Non
    </label>
  </div>

  <!-- Ligne 2 : villages à la suite sur la même ligne -->
  <div>
    <div style="margin-bottom:.4rem"><strong>Vous l'avez faite dans le village de :</strong></div>
    <div style="display:flex;flex-wrap:nowrap;gap:1.2rem;overflow:auto;white-space:nowrap">
      {% for v in villages %}
        <label style="display:inline-flex;align-items:center;gap:.35rem">
          <input type="radio" name="village" value="{{ v }}"
            {% if form and form.get('village') == v %}checked{% endif %}
            {% if v in villages_traite_today %}disabled class="village-option disabled"{% endif %}>
          {{ v }}
        </label>
      {% endfor %}
    </div>
  </div>

  <!-- Zone 1 -->
  <div style="display:flex;flex-direction:column;gap:.35rem">
    <label for="mem_visions"><strong>Vos visions et évènements :</strong></label>
    <textarea id="mem_visions" name="mem_visions" rows="7" {{ disabled }} style="width:100%;">{{ (form.get('mem_visions') if form else '') }}</textarea>
  </div>

  <!-- Zone 2 -->
  <div style="display:flex;flex-direction:column;gap:.35rem">
    <label for="villagers"><strong>Liste des villageois recensés en mairie :</strong></label>
    <textarea id="villagers" name="villagers" rows="7" required {{ disabled }} style="width:100%;">{{ (form.get('villagers') if form else '') }}</textarea>
  </div>

  <!-- Zone 3 -->
  <div style="display:flex;flex-direction:column;gap:.35rem">
    <label for="armies_groups"><strong>Armées et groupes présents hors de la ville :</strong></label>
    <textarea id="armies_groups" name="armies_groups" rows="7" required {{ disabled }} style="width:100%;">{{ (form.get('armies_groups') if form else '') }}</textarea>
  </div>

  <div>
    <button type="submit" {{ disabled }}>Générer le rapport</button>
  </div>
</form>

<hr style="margin-top:2rem;">

<p style="font-size:0.9rem;color:#666;text-align:center;">
  Pour toute information ou problème, contactez IG : <strong>Agatha.isabella</strong>
</p>
{% endblock %}
